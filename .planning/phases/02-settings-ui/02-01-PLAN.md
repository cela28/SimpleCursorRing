---
phase: 02-settings-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - SimpleCursorRing/Settings.lua
  - SimpleCursorRing/SimpleCursorRing.toc
autonomous: false

must_haves:
  truths:
    - "User can type /simplecursorring and settings panel opens"
    - "User can find SimpleCursorRing in Interface Options AddOns section"
    - "User can adjust ring size via slider and see immediate change"
    - "User can change ring color via color picker and see immediate change"
    - "User can toggle class color and see ring change to their class color"
    - "Color picker is disabled (grayed) when class color is enabled"
  artifacts:
    - path: "SimpleCursorRing/Settings.lua"
      provides: "Settings panel UI and registration"
      min_lines: 100
      contains: "Settings.RegisterCanvasLayoutCategory"
    - path: "SimpleCursorRing/SimpleCursorRing.toc"
      provides: "Settings.lua loaded after Core.lua"
      contains: "Settings.lua"
  key_links:
    - from: "SimpleCursorRing/Settings.lua"
      to: "SimpleCursorRing.UpdateRingSize"
      via: "slider OnValueChanged callback"
      pattern: "SimpleCursorRing\\.UpdateRingSize"
    - from: "SimpleCursorRing/Settings.lua"
      to: "SimpleCursorRing.UpdateRingColor"
      via: "color picker callback"
      pattern: "SimpleCursorRing\\.UpdateRingColor"
    - from: "SimpleCursorRing/Settings.lua"
      to: "SimpleCursorRing.SetUseClassColor"
      via: "checkbox OnClick callback"
      pattern: "SimpleCursorRing\\.SetUseClassColor"
    - from: "SimpleCursorRing/Settings.lua"
      to: "Settings.OpenToCategory"
      via: "slash command handler"
      pattern: "Settings\\.OpenToCategory"
---

<objective>
Create the settings UI panel with all controls (size slider, color picker, class color toggle) and register it with both the slash command system and Interface Options.

Purpose: Completes SETT-01 and SETT-02 — users can access and modify ring settings through standard WoW interfaces.

Output: A working Settings.lua that creates and registers the settings panel, allowing full customization through /simplecursorring or Interface Options.
</objective>

<execution_context>
@/home/sntanavaras/.claude/get-shit-done/workflows/execute-plan.md
@/home/sntanavaras/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-settings-ui/02-CONTEXT.md
@.planning/phases/02-settings-ui/02-RESEARCH.md
@.planning/phases/01-core-ring/01-02-SUMMARY.md
@SimpleCursorRing/Core.lua
@SimpleCursorRing/SimpleCursorRing.toc
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Settings Panel with Controls</name>
  <files>SimpleCursorRing/Settings.lua, SimpleCursorRing/SimpleCursorRing.toc</files>
  <action>
Create SimpleCursorRing/Settings.lua with:

1. **Panel Frame Creation:**
   - Create main frame using CreateFrame("Frame")
   - Set appropriate size for controls (~300x200)
   - Add optional title text at top if desired

2. **Size Slider (Ring Size):**
   - Create slider using CreateFrame("Slider", nil, panel, "OptionsSliderTemplate")
   - Set min=20, max=200, step=1
   - Position at top of control area
   - Label text: "Ring Size"
   - Show current value next to slider (e.g., "64")
   - OnValueChanged callback:
     - Check userInput parameter to avoid loops
     - If userInput: call SimpleCursorRing.UpdateRingSize(value)
     - Update value text display
   - Initialize slider value from SimpleCursorRingSaved.size

3. **Color Picker (Ring Color):**
   - Create color swatch button (small square showing current color)
   - Label text: "Ring Color"
   - OnClick: Open ColorPickerFrame with:
     - hasOpacity = true
     - r, g, b, opacity from SimpleCursorRingSaved.color
     - func callback: Get color via ColorPickerFrame:GetColorRGB(), call SimpleCursorRing.UpdateRingColor(r, g, b, a), update swatch
     - opacityFunc callback: Same as func (handles alpha changes)
     - cancelFunc callback: Restore original color from saved copy
   - Store reference to disable when class color enabled

4. **Class Color Toggle (Use Class Color):**
   - Create checkbox using CreateFrame("CheckButton", nil, panel, "UICheckButtonTemplate")
   - Label text: "Use Class Color"
   - OnClick callback:
     - Get checked state
     - Call SimpleCursorRing.SetUseClassColor(checked)
     - If checked: disable color picker (SetEnabled(false) + SetAlpha(0.5))
     - If unchecked: enable color picker (SetEnabled(true) + SetAlpha(1.0))
   - Initialize from SimpleCursorRingSaved.useClassColor
   - Apply initial disabled state to color picker if useClassColor is true

5. **Control Layout:**
   - Vertical arrangement: Size slider (top), Color picker (middle), Class color toggle (bottom)
   - Compact spacing between controls
   - All controls anchored to panel

6. **Update .toc file:**
   - Add Settings.lua AFTER Core.lua in file list (order matters - Settings.lua depends on SimpleCursorRing global)

**Critical patterns from RESEARCH.md:**
- OnValueChanged fires on SetValue() too — always check userInput parameter
- ColorPickerFrame.opacity for setup, GetColorAlpha() for reading
- SetEnabled(false) + SetAlpha(0.5) for visual disabled state
  </action>
  <verify>
File SimpleCursorRing/Settings.lua exists with:
- CreateFrame calls for panel, slider, checkbox
- OptionsSliderTemplate and UICheckButtonTemplate usage
- ColorPickerFrame setup
- SimpleCursorRing.UpdateRingSize, UpdateRingColor, SetUseClassColor calls
- .toc file includes Settings.lua after Core.lua
  </verify>
  <done>
Settings panel frame exists with all three controls (slider, color picker swatch, checkbox) properly created and wired to SimpleCursorRing API functions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Register Panel and Wire Slash Command</name>
  <files>SimpleCursorRing/Settings.lua</files>
  <action>
Add to Settings.lua:

1. **Register with Interface Options:**
   - Use Settings.RegisterCanvasLayoutCategory(panel, "SimpleCursorRing")
   - Store returned category reference in local variable
   - Call Settings.RegisterAddOnCategory(category)
   - This makes panel appear in Interface > AddOns > SimpleCursorRing

2. **Create Slash Command:**
   - Set SLASH_SIMPLECURSORRING1 = "/simplecursorring"
   - Set SLASH_SIMPLECURSORRING2 = "/scr" (short alias)
   - Create SlashCmdList["SIMPLECURSORRING"] handler function:
     - Call Settings.OpenToCategory(category:GetID())
     - No chat message (silent open per CONTEXT.md)

3. **Initialization Timing:**
   - Wrap registration in PLAYER_LOGIN event handler (Settings API may not be ready at ADDON_LOADED)
   - Create event frame, register PLAYER_LOGIN
   - OnEvent: Unregister event, then register category and create slash commands

**Critical patterns from RESEARCH.md:**
- Settings.OpenToCategory requires category:GetID() (returns number), NOT the category name string
- Must call BOTH RegisterCanvasLayoutCategory AND RegisterAddOnCategory
- Registration should happen after PLAYER_LOGIN for reliability
  </action>
  <verify>
Settings.lua contains:
- Settings.RegisterCanvasLayoutCategory call
- Settings.RegisterAddOnCategory call
- SLASH_SIMPLECURSORRING1 and SlashCmdList assignments
- Settings.OpenToCategory with category:GetID()
- PLAYER_LOGIN event handling
  </verify>
  <done>
Slash command /simplecursorring (and /scr) opens settings panel. Panel appears in Interface Options under AddOns section.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Settings UI in WoW</name>
  <what-built>
Complete settings UI with:
- Size slider (20-200px range, live preview)
- Color picker (swatch + full picker, live preview)
- Class color toggle (disables color picker when ON)
- /simplecursorring and /scr slash commands
- Interface Options panel registration
  </what-built>
  <how-to-verify>
1. Launch WoW and log into a character
2. Verify ring appears (Phase 1 functionality)
3. Type /simplecursorring in chat — settings panel should open
4. Test size slider:
   - Drag slider left/right
   - Ring should resize immediately
   - Value display should update
5. Test color picker:
   - Click color swatch
   - Color picker dialog should open
   - Select a new color
   - Ring should change color immediately
6. Test class color toggle:
   - Check "Use Class Color"
   - Ring should change to your class color
   - Color picker swatch should appear grayed/disabled
   - Uncheck toggle — ring returns to custom color, picker re-enabled
7. Test Interface Options:
   - Press Escape > Interface > AddOns
   - Find "SimpleCursorRing" in list
   - Verify same controls appear and work
8. Test persistence:
   - Make changes to settings
   - /reload
   - Verify settings persisted
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues encountered</resume-signal>
</task>

</tasks>

<verification>
- [ ] SimpleCursorRing/Settings.lua exists with panel, slider, color picker, checkbox
- [ ] SimpleCursorRing.toc includes Settings.lua after Core.lua
- [ ] /simplecursorring command opens settings panel
- [ ] Panel appears in Interface Options > AddOns
- [ ] Slider adjusts ring size with live preview
- [ ] Color picker changes ring color with live preview
- [ ] Class color toggle works and disables color picker
- [ ] Settings persist across /reload
</verification>

<success_criteria>
1. Typing /simplecursorring opens settings panel (SETT-01)
2. Settings panel appears in Interface Options under AddOns section (SETT-02)
3. All ring options (size slider, color picker, class color toggle) are accessible from both entry points
4. Changes made in settings panel immediately affect ring appearance
</success_criteria>

<output>
After completion, create `.planning/phases/02-settings-ui/02-01-SUMMARY.md`
</output>
